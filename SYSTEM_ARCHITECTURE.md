# ğŸ—ï¸ JUTHAZONE - à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡à¸£à¸°à¸šà¸šà¹à¸¥à¸°à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™

## ğŸ“‹ à¸ªà¸²à¸£à¸šà¸±à¸
1. [à¸ à¸²à¸à¸£à¸§à¸¡à¸£à¸°à¸šà¸š](#à¸ à¸²à¸à¸£à¸§à¸¡à¸£à¸°à¸šà¸š)
2. [à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡](#à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡)
3. [à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™](#à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™)
4. [à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥](#à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥)
5. [à¸¥à¸³à¸”à¸±à¸šà¸à¸²à¸£à¸„à¸³à¸™à¸§à¸“à¹€à¸§à¸¥à¸²](#à¸¥à¸³à¸”à¸±à¸šà¸à¸²à¸£à¸„à¸³à¸™à¸§à¸“à¹€à¸§à¸¥à¸²)
6. [à¸à¸²à¸£à¸‹à¸´à¸‡à¸„à¹Œà¸‚à¹‰à¸­à¸¡à¸¹à¸¥](#à¸à¸²à¸£à¸‹à¸´à¸‡à¸„à¹Œà¸‚à¹‰à¸­à¸¡à¸¹à¸¥)
7. [à¸£à¸°à¸šà¸šà¸ªà¸­à¸‡à¹‚à¸‹à¸™](#à¸£à¸°à¸šà¸šà¸ªà¸­à¸‡à¹‚à¸‹à¸™)

---

## à¸ à¸²à¸à¸£à¸§à¸¡à¸£à¸°à¸šà¸š

### ğŸ¯ à¸§à¸±à¸•à¸–à¸¸à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ
à¸ˆà¸±à¸”à¸à¸²à¸£à¸à¸²à¸£à¹€à¸¥à¹ˆà¸™à¸‚à¸­à¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²à¹ƒà¸™à¸˜à¸¸à¸£à¸à¸´à¸ˆà¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¹€à¸¥à¹ˆà¸™/à¸«à¹‰à¸­à¸‡à¹€à¸à¸¡à¸ªà¹Œ à¹‚à¸”à¸¢à¸¡à¸µ:
- â° à¸£à¸°à¸šà¸šà¸ˆà¸±à¸šà¹€à¸§à¸¥à¸² Real-time (à¸™à¸±à¸šà¸¥à¸‡)
- ğŸ’° à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£à¸„à¹ˆà¸²à¹ƒà¸Šà¹‰à¸ˆà¹ˆà¸²à¸¢
- ğŸ“± QR Code à¸ªà¸³à¸«à¸£à¸±à¸šà¸¥à¸¹à¸à¸„à¹‰à¸²
- ğŸ‘¤ à¹à¸¢à¸à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ Admin (à¸ˆà¸±à¸”à¸à¸²à¸£) à¹à¸¥à¸° Customer (à¸”à¸¹)
- ğŸ”µğŸ”´ à¸£à¸°à¸šà¸šà¸ªà¸­à¸‡à¹‚à¸‹à¸™ (Red Zone + Blue Zone)

---

## à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FRONTEND (React)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  BrowserRouter (React Router)             â”‚     â”‚
â”‚  â”‚  â”œâ”€ /login â†’ LoginPage                   â”‚     â”‚
â”‚  â”‚  â”œâ”€ /admin â†’ AdminDashboard              â”‚     â”‚
â”‚  â”‚  â”œâ”€ /customer â†’ CustomerView             â”‚     â”‚
â”‚  â”‚  â”œâ”€ /history â†’ HistoryView               â”‚     â”‚
â”‚  â”‚  â”œâ”€ /analytics â†’ AnalyticsView           â”‚     â”‚
â”‚  â”‚  â”œâ”€ /daily-summary â†’ DailySummaryView    â”‚     â”‚
â”‚  â”‚  â””â”€ /blue/* â†’ AppBlue (Alternative)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        State Management (App.jsx)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  useState:                                          â”‚
â”‚  â”œâ”€ customers[] â†’ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¸¹à¸à¸„à¹‰à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”                â”‚
â”‚  â”œâ”€ nextId â†’ ID à¸–à¸±à¸”à¹„à¸›                              â”‚
â”‚  â”œâ”€ user â†’ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ user à¸—à¸µà¹ˆ login                    â”‚
â”‚  â”œâ”€ isSupabaseReady â†’ à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ DB              â”‚
â”‚  â””â”€ channel â†’ BroadcastChannel à¹€à¸à¸·à¹ˆà¸­à¸‹à¸´à¸‡à¸„à¹Œ            â”‚
â”‚                                                     â”‚
â”‚  Timers:                                            â”‚
â”‚  â”œâ”€ setInterval(100ms) â†’ Update countdown          â”‚
â”‚  â”œâ”€ setInterval(30s) â†’ Sync to Supabase            â”‚
â”‚  â””â”€ Realtime subscription â†’ Listen DB changes      â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LOCAL STORAGE (Browser)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  â”œâ”€ juthazone_user â†’ {id, username, role}         â”‚
â”‚  â””â”€ selected_zone â†’ 'red' | 'blue'                 â”‚
â”‚                                                     â”‚
â”‚  (âš ï¸ No localStorage sync for customers)           â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    BACKEND: Supabase (PostgreSQL + Realtime)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  Tables:                                            â”‚
â”‚  â”œâ”€ customers (Red Zone)                           â”‚
â”‚  â”‚  â””â”€ id, name, room, minutes, cost, isPaid, ...  â”‚
â”‚  â”œâ”€ juthazoneb_customers (Blue Zone)               â”‚
â”‚  â”œâ”€ customers_history (à¸ªà¸³à¸«à¸£à¸±à¸š Red)                 â”‚
â”‚  â”œâ”€ juthazoneb_customers_history (à¸ªà¸³à¸«à¸£à¸±à¸š Blue)     â”‚
â”‚  â”œâ”€ users (à¸ªà¸³à¸«à¸£à¸±à¸š authentication)                  â”‚
â”‚  â”œâ”€ login_logs (à¸ªà¸³à¸«à¸£à¸±à¸š audit)                      â”‚
â”‚  â”œâ”€ user_activity_logs (à¸ªà¸³à¸«à¸£à¸±à¸š activity)           â”‚
â”‚  â”œâ”€ computer_zone_history (à¸«à¹‰à¸­à¸‡à¸„à¸­à¸¡à¸à¸´à¸§à¹€à¸•à¸­à¸£à¹Œ)        â”‚
â”‚  â””â”€ computer_zones (à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸«à¹‰à¸­à¸‡)                   â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™

### ğŸ“ à¸¥à¸³à¸”à¸±à¸š 1: User Login
```
Browser
   â†“
User visits http://localhost:5173/
   â†“
[ZoneSelection] â†’ à¹€à¸¥à¸·à¸­à¸ Red à¸«à¸£à¸·à¸­ Blue Zone
   â†“
[LoginPage] â†’ à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹à¸¥à¸°à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™
   â†“
authenticateUser() â†’ Query Supabase users table
   â†“
Password check (âš ï¸ plain text - security issue)
   â†“
Save to localStorage: juthazone_user
   â†“
Navigate to /admin (ProtectedRoute)
   â†“
App.jsx: setUser(userData)
```

### ğŸ“ à¸¥à¸³à¸”à¸±à¸š 2: Add Customer
```
Admin fills form:
â”œâ”€ à¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²
â”œâ”€ à¸«à¹‰à¸­à¸‡ (à¸ˆà¸²à¸à¸£à¸²à¸¢à¸à¸²à¸£ dropdown)
â”œâ”€ à¸ˆà¸³à¸™à¸§à¸™à¸™à¸²à¸—à¸µ
â”œâ”€ à¸„à¹ˆà¸²à¹ƒà¸Šà¹‰à¸ˆà¹ˆà¸²à¸¢
â””â”€ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸

   â†“
[Add Customer Button]
   â†“
addCustomer(customerData) in App.jsx:
â”œâ”€ Generate expectedEndTime = now + minutes
â”œâ”€ Set timeRemaining = minutes * 60 (seconds)
â”œâ”€ isRunning = true
â”œâ”€ isPaid = false
   â†“
setCustomers([...customers, newCustomer])
   â†“
Insert to Supabase customers table
   â†“
logActivity() â†’ à¸šà¸±à¸™à¸—à¸¶à¸à¸à¸²à¸£à¸à¸£à¸°à¸—à¸³
   â†“
Create customers_history record (start_time = now, end_reason = 'in_progress')
```

### ğŸ“ à¸¥à¸³à¸”à¸±à¸‡à¸à¸²à¸£ 3: Countdown Timer
```
Every 100ms:
   â†“
Check: elapsed time >= 950ms && <= 1050ms (1 second tolerance)
   â†“
Filter expired customers:
â”œâ”€ Find: customer.expectedEndTime <= now
â”œâ”€ Action: saveToHistory(customer, 'expired')
â”œâ”€ Remove from list
   â†“
Update state:
   setCustomers(filtered) 
   â†“
Every 30 seconds (if changes):
   â””â”€ updateFirebase(filtered) â†’ Supabase upsert
   
   â†“
Broadcast to other tabs via BroadcastChannel:
   â””â”€ channel.postMessage({type: 'UPDATE_CUSTOMERS', data: {...}})
```

### ğŸ“ à¸¥à¸³à¸”à¸±à¸š 4: Data Sync (Realtime)
```
Two mechanisms:
   â†“
1. Realtime Subscription (WebSocket):
   â”œâ”€ supabase.channel('customers-channel').on('postgres_changes', ...)
   â”œâ”€ Listen for INSERT, UPDATE, DELETE in customers table
   â””â”€ Action: fetchCustomers() â†’ refresh all data
   
2. Polling (Fallback):
   â”œâ”€ setInterval(30000) â†’ every 30 seconds
   â””â”€ fetchCustomers() â†’ if Supabase still responsive
```

### ğŸ“ à¸¥à¸³à¸”à¸±à¸š 5: Customer View (QR Scan)
```
Customer scans QR or visits /customer
   â†“
[CustomerView] component
   â†“
props.customers (from parent App.jsx)
   â†“
Display all customers as Cards:
â”œâ”€ Customer name
â”œâ”€ Room
â”œâ”€ Countdown timer (updates every 100ms)
â”œâ”€ Payment status (icon: âœ… or âŒ)
â””â”€ Blinking effect if time < 5 minutes
```

---

## à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥

### ğŸ“Š Customer Object
```javascript
{
  id: 1,                              // Auto increment
  name: "à¸ªà¸¡à¸Šà¸²à¸¢",                       // à¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²
  room: "à¸Šà¸±à¹‰à¸™ 2 à¸«à¹‰à¸­à¸‡ VIP",            // à¸«à¹‰à¸­à¸‡
  minutes: 120,                       // à¸™à¸²à¸—à¸µà¸—à¸µà¹ˆà¸ˆà¸­à¸‡
  cost: 300,                          // à¸„à¹ˆà¸²à¹ƒà¸Šà¹‰à¸ˆà¹ˆà¸²à¸¢
  note: "VIP customer",               // à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸
  paymentMethod: "transfer",          // transfer | cash
  shift: "1",                         // à¸à¸°à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸
  
  // Runtime computed
  timeRemaining: 7200,                // seconds (computed)
  isRunning: true,                    // à¸à¸³à¸¥à¸±à¸‡à¸™à¸±à¸šà¹€à¸§à¸¥à¸²
  isPaid: false,                      // à¸ˆà¹ˆà¸²à¸¢à¹€à¸‡à¸´à¸™à¹à¸¥à¹‰à¸§
  
  // Timestamps
  startTime: "2026-01-19T10:00:00Z",  // à¹€à¸§à¸¥à¸²à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™
  expectedEndTime: "2026-01-19T12:00:00Z",
  created_at: "2026-01-19T10:00:00Z", // Supabase auto
  updated_at: "2026-01-19T10:00:00Z"  // Supabase auto
}
```

### ğŸ“Š History Record
```javascript
{
  id: 1,
  customer_id: 1,
  name: "à¸ªà¸¡à¸Šà¸²à¸¢",
  room: "à¸Šà¸±à¹‰à¸™ 2 à¸«à¹‰à¸­à¸‡ VIP",
  note: "VIP customer",
  added_by: "admin_user",
  start_time: "2026-01-19T10:00:00Z",
  end_time: "2026-01-19T12:00:00Z",
  duration_minutes: 120,
  original_cost: 300,
  final_cost: 300,    // à¸­à¸²à¸ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ˆà¸²à¸à¸à¸²à¸£à¸›à¸£à¸±à¸šà¹€à¸§à¸¥à¸²
  is_paid: true,      // à¸ˆà¹ˆà¸²à¸¢à¹€à¸‡à¸´à¸™à¹à¸¥à¹‰à¸§
  end_reason: "expired" | "manual" | "in_progress", // à¹€à¸«à¸•à¸¸à¸œà¸¥à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”
  session_date: "2026-01-19",
  payment_method: "transfer",
  shift: "1"
}
```

### ğŸ“Š User Object
```javascript
{
  id: 1,
  username: "admin01",
  password: "123456",     // âš ï¸ Plain text - bad!
  role: "admin",          // admin | staff
  display_name: "Admin User",
  is_active: true,
  created_at: "2026-01-19T00:00:00Z"
}
```

---

## à¸¥à¸³à¸”à¸±à¸šà¸à¸²à¸£à¸„à¸³à¸™à¸§à¸“à¹€à¸§à¸¥à¸²

### ğŸ”¢ à¸à¸²à¸£à¸„à¸³à¸™à¸§à¸“ timeRemaining

```javascript
// CURRENT LOGIC (from App.jsx)

// 1. à¹€à¸¡à¸·à¹ˆà¸­ Add Customer:
const expectedEndTime = new Date(now.getTime() + customerData.minutes * 60 * 1000)
// Example: now = 10:00, minutes = 2
//         expectedEndTime = 10:02

// 2. Display à¹ƒà¸Šà¹‰ calculateTimeRemaining():
const now = Date.now()
const endTimeMs = new Date(expectedEndTime).getTime()
const timeRemainingMs = endTimeMs - now
const timeRemainingSeconds = Math.max(0, Math.ceil(timeRemainingMs / 1000))

// 3. Format display:
const hours = Math.floor(timeRemainingSeconds / 3600)
const minutes = Math.floor((timeRemainingSeconds % 3600) / 60)
const seconds = timeRemainingSeconds % 60

// Display: "02:00" or "1 à¸Šà¸¡ 30 à¸™à¸²à¸—à¸µ"

// 4. Expiration check:
if (timeRemainingSeconds <= 0) {
  // Move to history
  // Remove from customers list
  // Alert user
}
```

### âœ… Advantages:
- No need to update timeRemaining every second
- Computed on-demand from expectedEndTime
- Accurate across page reloads
- No drift over time

---

## à¸à¸²à¸£à¸‹à¸´à¸‡à¸„à¹Œà¸‚à¹‰à¸­à¸¡à¸¹à¸¥

### ğŸ”„ 3 Levels of Sync

```
Level 1: Client-to-Client (Same Browser)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  BroadcastChannel  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Tab 1     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Tab 2     â”‚
â”‚ (Admin)     â”‚                   â”‚ (Customer)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Updates share real-time state

Level 2: Client-to-Server (Supabase)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ React App    â”‚â”€â”€30-secondâ”€â”€â”€â”€â”€â”€â”€â”‚  Supabase    â”‚
â”‚ (setInterval)â”‚     polling      â”‚ (PostgreSQL) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Level 3: Server-to-Client (Realtime Subscription)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ React App    â”‚â—„â”€â”€WebSocketâ”€â”€â”€â”€â”€â”‚  Supabase    â”‚
â”‚ (listener)   â”‚  (Realtime)      â”‚ (Real-time)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  When ANY user updates database
  Trigger: fetchCustomers() in all connected clients
```

### ğŸ”€ Race Condition Risk
```
Scenario: User A adds customer while User B adds customer

User A:                          User B:
setCustomers([...])             setCustomers([...])
   â†“ (100ms)                        â†“ (100ms)
updateFirebase()                updateFirebase()
   â†“                               â†“
Supabase upsert                 Supabase upsert
   â†“                               â†“
Data might conflict!

Solution: Supabase uses onConflict: 'id' 
â†’ Last write wins
â†’ Acceptable for this use case (not critical data)
```

---

## à¸£à¸°à¸šà¸šà¸ªà¸­à¸‡à¹‚à¸‹à¸™

### ğŸ”´ RED ZONE (Fixed-time pricing)
```
Files:
â”œâ”€ App.jsx (main app)
â”œâ”€ AdminDashboard.jsx
â”œâ”€ CustomerView.jsx
â””â”€ HistoryView.jsx

Database:
â”œâ”€ customers (Red Zone)
â””â”€ customers_history

Pricing Logic:
â”œâ”€ Input: name, room, minutes, cost
â””â”€ Charge: fixed cost regardless of actual usage
```

### ğŸ”µ BLUE ZONE (Pro-rated pricing)
```
Files:
â”œâ”€ AppBlue.jsx (alternative app)
â”œâ”€ AdminDashboardBlue.jsx
â”œâ”€ CustomerViewBlue.jsx
â””â”€ AnalyticsViewBlue.jsx

Database:
â”œâ”€ juthazoneb_customers (Blue Zone)
â””â”€ juthazoneb_customers_history

Pricing Logic:
â”œâ”€ Input: hours, transferAmount, cashAmount
â””â”€ Charge: based on actual time used (auto-calc)

Duration Calculation:
start_time â†’ end_time â†’ duration â†’ auto-charge
```

### ğŸ”€ Switch Zone Flow
```
User at /
   â†“
[ZoneSelection]
â”œâ”€ Button Red Zone  â†’ localStorage.selected_zone = 'red'
â”‚                   â†’ /login (App.jsx)
â”‚
â””â”€ Button Blue Zone â†’ localStorage.selected_zone = 'blue'
                    â†’ /login (LoginPage)
                    â†’ navigate('/blue/admin')
                    â†’ AppBlue.jsx (renders)
```

---

## ğŸ” Authentication Flow

```
1. Visit /login
   â†“
2. [LoginPage] â†’ Enter username & password
   â†“
3. authenticateUser(username, password)
   â”œâ”€ Query: SELECT * FROM users WHERE username = ?
   â”œâ”€ Check: plain text password match
   â”œâ”€ Check: is_active = true
   â†“
4. If success:
   â”œâ”€ logLoginAttempt(username, true) â†’ login_logs table
   â”œâ”€ logActivity() â†’ user_activity_logs
   â”œâ”€ localStorage.juthazone_user = {id, username, role, ...}
   â””â”€ navigate('/admin')
   â†“
5. App.jsx checks localStorage on mount
   â””â”€ If found: setUser(userData)

6. ProtectedRoute wraps /admin, /history, /analytics
   â”œâ”€ If user â†’ render component
   â””â”€ If !user â†’ navigate('/login')

7. Logout:
   â”œâ”€ logLogout() â†’ update login_logs with logout_time
   â”œâ”€ localStorage.removeItem('juthazone_user')
   â”œâ”€ setUser(null)
   â””â”€ navigate('/login')
```

---

## ğŸ“± Components Hierarchy

```
App.jsx (Main state holder)
â”œâ”€ state: customers, user, nextId, isSupabaseReady
â”œâ”€ functions: addCustomer, toggleTimer, addTime, ...
â”‚
â”œâ”€ [Route /]
â”‚  â””â”€ ZoneSelection
â”‚
â”œâ”€ [Route /login]
â”‚  â””â”€ LoginPage (handles login)
â”‚
â”œâ”€ [Route /admin]
â”‚  â””â”€ ProtectedRoute
â”‚     â””â”€ AdminDashboard (receives customers, callbacks)
â”‚        â”œâ”€ CustomerList (table)
â”‚        â”œâ”€ AddCustomerForm
â”‚        â”œâ”€ ComputerZoneEntry (separate zone)
â”‚        â””â”€ ComputerZoneManager (modal)
â”‚
â”œâ”€ [Route /customer]
â”‚  â””â”€ CustomerView (public page)
â”‚     â””â”€ CustomerCard (repeated for each customer)
â”‚
â”œâ”€ [Route /history]
â”‚  â””â”€ ProtectedRoute
â”‚     â””â”€ HistoryView (query customers_history)
â”‚
â”œâ”€ [Route /analytics]
â”‚  â””â”€ ProtectedRoute
â”‚     â””â”€ AnalyticsView (recharts dashboard)
â”‚
â”œâ”€ [Route /daily-summary]
â”‚  â””â”€ ProtectedRoute
â”‚     â””â”€ DailySummaryView (daily stats)
â”‚
â””â”€ [Route /blue/*]
   â””â”€ AppBlue (alternative app for Blue Zone)
```

---

## ğŸ”„ Update Mechanisms

### How changes propagate:

```
User clicks "Add Customer" in Admin
   â†“
AdminDashboard.jsx calls addCustomer(data)
   â†“
App.jsx:
â”œâ”€ setCustomers([...customers, new])
â”œâ”€ Insert to Supabase
â”œâ”€ logActivity()
â”œâ”€ BroadcastChannel.postMessage()
   â†“
Updates propagate:
â”œâ”€ Local state immediately
â”œâ”€ Supabase within 100ms
â”œâ”€ Other tabs via BroadcastChannel within 100ms
â”œâ”€ CustomerView re-renders
â””â”€ Timer starts counting down
```

---

## âš™ï¸ Performance Optimizations

1. **Timestamp-based countdown** (not recompute every second)
2. **Polling interval: 30 seconds** (not every second)
3. **Realtime subscription** (not pull-only)
4. **useCallback memoization** in DailySummaryView
5. **BroadcastChannel** for tab sync (not API calls)
6. **Selective field sync** (not entire customer object)

---

## ğŸ“Š Summary Table

| Feature | Red Zone | Blue Zone |
|---------|----------|-----------|
| Pricing | Fixed | Pro-rated |
| Files | App.jsx | AppBlue.jsx |
| Table | `customers` | `juthazoneb_customers` |
| History | `customers_history` | `juthazoneb_customers_history` |
| Auth | Shared | Shared |
| Billing | Manual | Auto-calculated |

---

**Last Updated:** Jan 19, 2026
